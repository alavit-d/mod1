<!doctype html>
<html>
	<head>
		<title>mod1</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
	</body>
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.js"></script>
	<script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js"></script>
	<script src="./ground.js"></script>
	<script src="./water.js"></script>
	<script>
			var scene = new THREE.Scene();
			//for (var i = 0; i < 100; i++) 
			//	fluid(ground, water);
			//for (var i = 0; i < ground.length; i++)
			//	ground[i] += water[i];
			var texture = THREE.ImageUtils.loadTexture("textures/greenbark.jpg");
			var quality = 32, step = 1024 / quality;
			var geometry = new THREE.PlaneGeometry( 1024, 1024, quality - 1, quality - 1);
			for (var i = 0, l = geometry.vertices.length; i < l; i++) {
				var x = i % quality, y = Math.floor( i / quality );
				geometry.vertices[i].z = -ground[ ( x * step ) + ( y * step ) * 1024];
			}
			geometry.applyMatrix( new THREE.Matrix4().makeRotationX(  Math.PI / 2 ) );
			var material = new THREE.MeshBasicMaterial( {map: texture, side:THREE.DoubleSide } ); 
			var ground = new THREE.Mesh(geometry, material);
			scene.add( ground );
			/*var waterHeight = new THREE.PlaneGeometry(1024, 1024, quality - 1, quality - 1);
			for (var i = 0, l = waterHeight.vertices.length; i < l; i++) {
				waterHeight.vertices[i].z = -50;
			}
			waterHeight.applyMatrix( new THREE.Matrix4().makeRotationX(  Math.PI / 2 ) );
			var waterMat = new THREE.MeshBasicMaterial( { color: 0xffff00 } );
			var water = new THREE.Mesh(waterHeight, waterMat);
			scene.add( water );	*/

	//Generate camera
			var camera = new THREE.PerspectiveCamera( 60, window.innerWidth/window.innerHeight, 1, 10000 );
			camera.position.x = 700;
			camera.position.z = 700;
			camera.position.y = 700;
			camera.lookAt(new THREE.Vector3(0, 0, 0));
			var controls = new THREE.OrbitControls( camera );
			//controls.addEventListener( 'change', render );
	//Print scene
			var renderer = new THREE.WebGLRenderer();
			renderer.setPixelRatio( window.devicePixelRatio );
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setClearColor(0xFFFFFF, 1); 
			document.body.appendChild( renderer.domElement );
			var render = function() {
				requestAnimationFrame( render );
				//controls.update();
				renderer.render(scene, camera);
			}
			$(window).load(function () {
				render();
		});
		</script>
</html>
